name: API Tests (Gradle)   # Nama workflow yang akan tampil di tab Actions

on:
  workflow_dispatch:       # Bisa dijalankan manual via GitHub Actions UI
  push:                    # Akan otomatis jalan kalau ada commit/push ke branch main
    branches: [ "main" ]
  pull_request:            # Akan otomatis jalan kalau ada Pull Request (PR) ke branch main
    branches: [ "main" ]

jobs:
  Api-Rest-Assured:
    runs-on: ubuntu-latest # Mesin/runner Ubuntu terbaru yang disediakan GitHub

    steps:
      # 1. Ambil source code dari repository GitHub agar bisa dipakai
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. Setup Java Development Kit (JDK) versi 17
      #    Karena project Gradle + RestAssured ini butuh JDK 17
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          distribution: temurin     # Distribusi JDK (Temurin open-source)
          java-version: 17          # Versi Java yang digunakan

      # 3. Beri permission agar file gradlew bisa dijalankan di Linux (Ubuntu)
      - name: Grant execute permission for Gradlew
        run: chmod +x gradlew

      # 4. Jalankan perintah Gradle: clean project lalu jalankan semua test
      #    Di tahap ini semua API test RestAssured/TestNG dieksekusi
      - name: Run Tests with Gradle
        run: ./gradlew clean test

      # 5. Upload hasil test dalam format XML (JUnit/TestNG) agar bisa didownload dari GitHub Actions
      - name: Upload Test Results (XML)
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: build/test-results/test

      # 6. Upload hasil test dalam format HTML (lebih mudah dibaca untuk non-teknis)
      - name: Upload HTML Test Report
        uses: actions/upload-artifact@v4
        with:
          name: test-report
          path: build/reports/tests/test

      # 7. Tambahkan summary ringkas di tab GitHub Actions â†’ Summary
      #    Ini untuk memudahkan tim melihat status build tanpa buka log panjang
      - name: Add Build Summary
        run: |
          echo "## âœ… Build & Test Summary" >> $GITHUB_STEP_SUMMARY
          echo "- Status   : Sukses ðŸŽ‰" >> $GITHUB_STEP_SUMMARY
          echo "- Test Tool: Gradle + TestNG + RestAssured" >> $GITHUB_STEP_SUMMARY
          echo "- Report   : [Download XML/HTML report](${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }})" >> $GITHUB_STEP_SUMMARY
